<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Unit Testing in Angular</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/league.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<!--Title-->
			<section>
				<h1>Unit Testing in Angular</h1>
				<h3>By Keith Stewart</h3>
        <a href="https://twitter.com/TheKeithStewart" target="_blank">@TheKeithStewart</a>
        
        <p><a href="https://goo.gl/ehFzWk">https://goo.gl/ehFzWk</a></p>
			</section>

			<section>
				<h2>Agenda</h2>

				<ul>
					<li>Why should we test?</li>
					<li>Different types of tests</li>
					<li>Tools and Technologies</li>
					<li>Mocks and Spys</li>
					<li>The application we will be testing</li>
					<li>What do unit tests look like?</li>
					<li>Write unit tests for existing functionality</li>
					<li>Add a new feature using TDD</li>
				</ul>
			</section>

			<!-- The beginning -->

			<section>
				<h2>Why should we test?</h2>

				<section>
					<blockquote>
						&ldquo;Automated testing is the enabler... It is the thing that allows us to iterate on our code, bring more features, make
						risky refactorings, make aggresive performance optimizations, all while knowing that all the features we've built already
						still work.&rdquo;
					</blockquote>

					<p style="font-size: 24px">Igor Minar - "Software Engineering as an Engineering Discipline" at AngularMix</p>
				</section>

				<section>
					<p>The primary benefits of testing your applications are:</p>

					<ul>
						<li class="fragment">Improved code quality</li>
						<li class="fragment">Reduced overall cost of development</li>
						<li class="fragment">Better documentation of code</li>
						<li class="fragment">Increased confidence in refactorings</li>
					</ul>
				</section>
			</section>

			<section>
				<h2>Different Types of Tests</h2>

				<section>
					<p>Most common types of tests used in Angular applications are:</p>

					<ul>
						<li>Unit tests</li>
						<li>Functional tests</li>
						<li>End-to-end (e2e) tests</li>
					</ul>
				</section>

				<section>
					<p>Unit Testing:</p>

					<blockquote>
						Unit testing is a software testing method by which individual units of source code... are tested to determine whether they
						are fit for use.
					</blockquote>

					<p style="font-size: 24px">Source:
						<a href="https://en.wikipedia.org/wiki/Unit_testing">https://en.wikipedia.org/wiki/Unit_testing</a>
					</p>
				</section>

				<section>
					<p>Functional Testing:</p>

					<blockquote>
						Functional testing is a way of checking software to ensure that it has all the required functionality that's specified within
						its functional requirements.
					</blockquote>

					<p style="font-size: 24px">Source:
						<a href="https://www.techopedia.com/definition/19509/functional-testing">https://www.techopedia.com/definition/19509/functional-testing</a>
					</p>
				</section>

				<section>
					<p>End-to-end Testing</p>

					<blockquote>
						End-to-end testing is a methodology used to test whether the flow of an application is performing as designed from start
						to finish. The purpose of carrying out end-to-end tests is to identify system dependencies and to ensure that the right
						information is passed between various system components and systems.
					</blockquote>

					<p style="font-size: 24px">Source:
						<a href="https://www.techopedia.com/definition/7035/end-to-end-test">https://www.techopedia.com/definition/7035/end-to-end-test</a>
					</p>
				</section>
			</section>

			<section>
				<h2>Tools and Technologies</h2>

				<section>
					<table>
						<thead>
							<th>Type</th>
							<th>Technologies</th>
						</thead>
						<tbody>
							<tr>
								<td>Test Framework</td>
								<td>
									<div>
										<a href="https://jasmine.github.io/2.0/introduction.html">Jasmine</a>
									</div>
									<div>
										<a href="http://mochajs.org/">Mocha</a>
									</div>
								</td>
							</tr>
							<tr>
								<td>Test Runner</td>
								<td>
									<div>
										<a href="https://karma-runner.github.io/1.0/index.html">Karma</a>
									</div>
									<div>
										<a href="https://wallabyjs.com/">Wallaby.js</a>
									</div>
								</td>
							</tr>
							<tr>
								<td style="padding-right: 50px">End-to-end Test Framework</td>
								<td>
									<div>
										<a href="http://www.protractortest.org/#/">Protractor</a>
									</div>
									<div>
										<a href="https://www.cypress.io/">Cypress.io</a>
									</div>
								</td>
							</tr>
						</tbody>
					</table>

					<div>&nbsp;</div>
					<div>&nbsp;</div>
				</section>

				<section>
					<table>
						<thead>
							<th>Type</th>
							<th>Technologies</th>
						</thead>
						<tbody>
							<tr>
								<td>Test Framework</td>
								<td>
									<div>
										<a href="https://jasmine.github.io/2.0/introduction.html" style="color: green">Jasmine</a>
									</div>
									<div>
										<a href="http://mochajs.org/">Mocha</a>
									</div>
								</td>
							</tr>
							<tr>
								<td>Test Runner</td>
								<td>
									<div>
										<a href="https://karma-runner.github.io/1.0/index.html" style="color: green">Karma</a>
									</div>
									<div>
										<a href="https://wallabyjs.com/" style="color: green">Wallaby.js</a>
									</div>
								</td>
							</tr>
							<tr>
								<td style="padding-right: 50px; color: red">End-to-end Test Framework</td>
								<td>
									<div>
										<a href="http://www.protractortest.org/#/">Protractor</a>
									</div>
									<div>
										<a href="https://www.cypress.io/">Cypress.io</a>
									</div>
								</td>
							</tr>
						</tbody>
					</table>

					<div style="color: green">Covered in this presentation</div>

					<div style="color: red">To be covered in a separate presentation</div>
				</section>

			</section>

			<section>
				<h2>Jasmine</h2>
				
				<section>
					<img style="background-color: white" src="https://jasmine.github.io//images/jasmine-horizontal.svg" alt="">
	
					<p>A behavior-driven development framework that is commonly used when testing JavaScript code.</p>
				</section>
	
				<section>
	
					Allows you to write tests against scenarios in a structure like this:
	
					<pre style="width: 700px"><code class="javascript" data-trim style="font-size: 18px;">
describe('#onSelect', () => {
  it('should set the selectedCharacter property', () => {
    const character = new Character();

    component.onSelect(character);
    expect(component.selectedCharacter).toBe(character);
  });
});
					</code></pre>
				</section>
	
				<section>
					<p>Some of the common matchers included with Jasmine are:</p>
	
					<table style="font-size: 30px">
						<thead>
							<th>Matcher</th>
							<th>Definition</th>
						</thead>
						<tbody>
							<tr>
								<td>toEqual()</td>
								<td>e.g. a == b</td>
							</tr>
							<tr>
								<td>toBe()</td>
								<td>e.g. a === b</td>
							</tr>
							<tr>
								<td>toMatch()</td>
								<td>matches based on a regular expression</td>
							</tr>
							<tr>
								<td>toHaveBeenCalled()</td>
								<td>function has been called</td>
							</tr>
							<tr>
								<td>toHaveBeenCalledWith()</td>
								<td>function has been called with certain arguments</td>
							</tr>
						</tbody>
					</table>
				</section>
			</section>

			<section>
				<h2>Test Runners</h2>

				<section>
					<img style="border: none; height: 75%; width: 75%;" src="/images/karma.png">

					<p>Karma is the most commonly used test runner with Angular applications</p>
				</section>

				<section>
					<p>Running unit tests with the Angular CLI and Karma</p>
	
					<div>
						<ul style="list-style-type: none;">
							<li>// generating a new project</li>
							<li>$ <span style="color: red">ng new my-new-project</span></li>
						</ul>
					</div>
	
					<br />
	
					<div>
						<ul style="list-style-type: none;">
							<li>// start unit tests via Karma</li>
							<li>$ ng
								<span style="color: red">test</span>
							</li>
						</ul>
					</div>
				</section>

				<section>
					<p style="margin-top: 60px;">Karma allows you to continuously run tests as you are saving changing to your code</p>

					<img style="border: none;" src="/images/karma-report.png">
				</section>

				<section>
					<img style="border: none;" src="/images/wallabyjs.png">

					<p>Wallaby</p>
				</section>

				<section>
					<p>Wallaby runs continuously as your are writing your code giving you quick feedback without having to save.</p>

					<img style="border: none;" src="/images/vscode_inline.gif">
				</section>
			</section>

			<section>
				<h2>Mocks and Spys</h2>

				<section>
					<div style="display: flex; justify-content: space-between">
						<img class="fragment" style="border: none;" src="/images/mock.jpg">
						<img class="fragment" style="border: none;" src="/images/homer-spy.jpeg">				
					</div>
				</section>

				<section>
          <h3>mocks:</h3>

					<blockquote>
            &ldquo;...mock objects are simulated objects that mimic the behavior of real objects in controlled ways&rdquo;
          </blockquote>
  
            <p style="font-size: 24px"><a href="https://en.wikipedia.org/wiki/Mock_object">https://en.wikipedia.org/wiki/Mock_object</a></p>
          </section>
			</section>

			<section>
				<h2>App we are Testing</h2>

				<section>
					<div style="display: flex; justify-content:space-between;">
						<div style="flex: auto" class="fragment fade-right">
							<h2>Tour of Heroes</h2>
							<img style="border: none;" src="/images/hero.jpg">
						</div>
	
						<div>
							<h2 style="flex: auto; padding: 200px 0; color: red" class="fragment fade-down">vs.</h2>
						</div>
	
						<div style="flex: auto" class="fragment fade-left">
							<h2>Villians!!!</h2>
							<img style="border: none;" src="/images/villains.jpg">
						</div>
					</div>
				</section>

				<section>
					<p>Same old Tour of Heroes but with a twist:</p>

					<ul>
            <li class="fragment">Add concept of <span style="color: red">villains</span></li>
            <li class="fragment">Add unit tests to most of the existing functions</li>
					</ul>
				</section>
			</section>

			<section>
        <h2>Example Tests</h2>
      </section>

				<section>
          <p>router.navigate()</p>

          <div class="fragment">
          <p>Function:</p>

          <pre style="width: 700px"><code class="javascript" data-trim style="font-size: 18px;">
gotoDetail(character: Character): void {
  const link = ['/detail', character.id];
  this.router.navigate(link);
}            
          </code></pre>
          </div>

          <div class="fragment">
          <p>Test:</p>

          <pre style="width: 900px"><code class="javascript" data-trim style="font-size: 18px;">
it('should navigate to the details page for the given character', () => {
  const spy = spyOn(router, 'navigate');
  const character = new Character();
  character.id = 1;
  
  component.gotoDetail(character);
  expect(router.navigate).toHaveBeenCalledWith(['/detail', character.id]);
});
          </code></pre>
          </div>
        </section>
        
				<section>
          <p>fakeAsync() and tick()</p>

          <div class="fragment">
          <p>Function:</p>

          <pre style="width: 700px"><code class="javascript" data-trim style="font-size: 18px;">
save(): void {
  this.characterService
    .save(this.character)
    .then(character => {
      this.character = character;
      this.goBack(character);
    })
    .catch(error => this.error = error);
}    
          </code></pre>
          </div>

          <div class="fragment">
          <p>Test:</p>

          <pre style="width: 900px"><code class="javascript" data-trim style="font-size: 18px;">
it('should display an error if save fails', fakeAsync(() => {
  spyOn(characterService, 'save')
    .and.returnValue(new Promise((resolve, reject) => reject('Error!')));
  
  component.save();
  tick();
  expect(component.error).toEqual('Error!');
}));
          </code></pre>
          </div>
				</section>
        
				<section>
          <p>Event Emitting</p>

          <div class="fragment">
          <p>Function:</p>

          <pre style="width: 700px"><code class="javascript" data-trim style="font-size: 18px;">
goBack(savedCharacter: Character = null): void {
  this.close.emit(savedCharacter);
  /* ... */
}
          </code></pre>
          </div>

          <div class="fragment">
          <p>Test:</p>

          <pre style="width: 900px"><code class="javascript" data-trim style="font-size: 18px;">
it('should emit the saved character', () => {
  const expected = new Character();
  component.close
    .subscribe(result => expect(result).toBe(expected));
  
  component.goBack(expected);
});
          </code></pre>
          </div>
				</section>
        
				<section>
          <p>Global objects like window and localStorage</p>

          <div class="fragment">
          <p>Function:</p>

          <pre style="width: 700px"><code class="javascript" data-trim style="font-size: 18px;">
goBack(savedCharacter: Character = null): void {
  /* ... */
  if (this.navigated) { window.history.back(); }
}
          </code></pre>
          </div>

          <div class="fragment">
          <p>Test:</p>

          <pre style="width: 900px"><code class="javascript" data-trim style="font-size: 18px;">
it('should go back if navigated is true', () => {
  const spy = spyOn(window.history, 'back');
  component.navigated = true;
  
  component.goBack();
  expect(spy).toHaveBeenCalled();
});
          </code></pre>
          </div>
				</section>
        
				<section>
          <p>Http</p>

          <section>
          <p>Function:</p>

          <pre style="width: 700px"><code class="javascript" data-trim style="font-size: 18px;">
getCharacters() {
  return this.http
    .get(this.charactersUrl)
    .toPromise()
    .then((response) => {
      return response.json().data as Character[];
    })
    .catch(this._handleError);
}
          </code></pre>
          </section>

          <section>
          <p>Test:</p>

          <pre style="width: 1000px"><code class="javascript" data-trim style="font-size: 18px;">
it('should return characters', fakeAsync(() => {
  const character1 = new Character();
  const character2 = new Character();
  let result: Character[];
  
  service.getCharacters().then(characters => result = characters);
  lastConnection.mockRespond(new Response(new ResponseOptions({
    body: { data: [character1, character2] }
  })));
  tick();
  expect(lastConnection.request.url).toMatch(/app\/characters$/);
  expect(result.length).toEqual(2);
  expect(result[0]).toEqual(character1);
  expect(result[1]).toEqual(character2);
}));
          </code></pre>
          </section>
        </section>
        
				<section>
          <p>HttpClient</p>

          <section>
          <p>Test:</p>

          <pre style="width: 1000px"><code class="javascript" data-trim style="font-size: 18px;">
it('should return characters', () => {
  const character1 = new Character();
  const character2 = new Character();
  let result: Character[];
  service.getCharacters().subscribe(characters => result = characters);
  
  const req = httpMock.expectOne(`app/characters`);
  expect(req.request.method).toEqual('GET');
  req.flush([character1, character2]);
  expect(result.length).toEqual(2);
  expect(result[0]).toEqual(character1);
  expect(result[1]).toEqual(character2);
});
          </code></pre>
          </section>
				</section>

			<section>
        <h2>It's TDD Time</h2>
        
        <p>The feature we are going to develop using TDD is:</p>

        <div class="fragment">
          <p>Villains attacking heroes!!!</p>

          <img src="https://media.giphy.com/media/o2Lwy4g7Dzptu/giphy.gif">
        </div>
			</section>

      <section>
        <h2>Let's code!!!</h2>
      </section>
		</div>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// More info https://github.com/hakimel/reveal.js#configuration
		Reveal.initialize({
			controls: true,
			progress: true,
			history: true,
			transition: 'fade',
			width: "90%",

			// More info https://github.com/hakimel/reveal.js#dependencies
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>
</body>

</html>